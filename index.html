<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tempo Expert - Console Officielle</title>
    <style>
        :root {
            --bg: #080808; --blue-t: #0066ff; --white-t: #f5f5f5; --red-t: #ff0000;
            --green: #00e676; --blue-d: #2979ff; --red-d: #ff1744; --grey: #222;
        }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; padding: 10px; margin: 0; }
        .box { background: rgba(255,255,255,0.05); border-radius: 24px; padding: 20px; border: 1px solid rgba(255,255,255,0.1); width: 100%; max-width: 420px; box-sizing: border-box; }

        /* Badges Tempo */
        .tempo-row { display: flex; gap: 8px; margin-bottom: 20px; }
        .t-badge { flex: 1; padding: 12px 5px; border-radius: 12px; text-align: center; font-size: 0.6rem; font-weight: 900; color: black; line-height: 1.2; }
        .BLEU { background: var(--blue-t); color: white; }
        .BLANC { background: var(--white-t); color: #333; }
        .ROUGE { background: var(--red-t); color: white; }
        .NON_DEFINI { background: #333; color: #777; }

        /* Stats Jours Restants */
        .stats-row { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 25px; background: rgba(255,255,255,0.02); padding: 10px; border-radius: 16px; }
        .stat-item { text-align: center; flex: 1; }
        .stat-val { font-size: 1rem; font-weight: 900; display: block; }
        .stat-lbl { font-size: 0.5rem; color: #555; text-transform: uppercase; font-weight: bold; }

        .header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px; border-bottom: 1px solid #111; padding-bottom: 15px; }
        .time-val { font-size: 1.8rem; color: var(--blue-d); font-weight: 900; }
        
        .section-title { font-size: 0.6rem; color: #555; text-transform: uppercase; font-weight: 900; margin-bottom: 10px; letter-spacing: 1px; }
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .card { background: rgba(255,255,255,0.02); padding: 12px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); }
        .val { font-size: 1.1rem; font-weight: 900; }

        .flux-item { display: flex; justify-content: space-between; font-size: 0.75rem; padding: 8px 5px; border-bottom: 1px solid #1a1a1a; }
        .btn-refresh { width: 100%; background: none; color: #444; border: 1px solid #222; padding: 12px; border-radius: 14px; font-size: 0.65rem; font-weight: bold; cursor: pointer; margin-top: 15px; }
    </style>
</head>
<body>

<div class="box">
    <div class="section-title">Calendrier Officiel</div>
    <div class="tempo-row">
        <div id="t-yesterday" class="t-badge NON_DEFINI">HIER<br>-</div>
        <div id="t-today" class="t-badge NON_DEFINI">AUJOURD'HUI<br>-</div>
        <div id="t-tomorrow" class="t-badge NON_DEFINI">DEMAIN<br>-</div>
    </div>

    <div class="section-title">Jours Restants (Saison)</div>
    <div class="stats-row">
        <div class="stat-item"><span id="rem-bleu" class="stat-val" style="color:var(--blue-t)">-</span><span class="stat-lbl">Bleus</span></div>
        <div class="stat-item"><span id="rem-blanc" class="stat-val" style="color:var(--white-t)">-</span><span class="stat-lbl">Blancs</span></div>
        <div class="stat-item"><span id="rem-rouge" class="stat-val" style="color:var(--red-t)">-</span><span class="stat-lbl">Rouges</span></div>
    </div>

    <div class="header">
        <div>
            <div id="date-str" style="font-size: 0.7rem; color: #555; font-weight: bold;">--</div>
            <div id="time-str" class="time-val">--:--</div>
        </div>
        <div id="co2-val" style="color: var(--green); font-size: 0.8rem; font-weight: bold; background: rgba(0,230,118,0.1); padding: 5px 10px; border-radius: 8px;">-- g/kWh</div>
    </div>

    <div class="main-grid">
        <div class="card">
            <div class="section-title" style="margin-bottom:5px;">PRODUCTION</div>
            <div id="prod-val" class="val" style="color: var(--green);">--</div>
        </div>
        <div class="card">
            <div class="section-title" style="margin-bottom:5px;">CONSO RÃ‰ELLE</div>
            <div id="conso-val" class="val">--</div>
        </div>
    </div>

    <div class="section-title">Ã‰changes RÃ©seau (MW)</div>
    <div id="flux-list"></div>

    <button class="btn-refresh" onclick="updateAll()">ðŸ”„ ACTUALISER TOUT</button>
</div>

<script>
const apiBase = "https://www.api-couleur-tempo.fr/api";

async function fetchTempo() {
    try {
        const [y, t, tm, s] = await Promise.all([
            fetch(`${apiBase}/jourTempo/yesterday`).then(r => r.json()),
            fetch(`${apiBase}/jourTempo/today`).then(r => r.json()),
            fetch(`${apiBase}/jourTempo/tomorrow`).then(r => r.json()),
            fetch(`${apiBase}/stats`).then(r => r.json())
        ]);

        updateBadge('t-yesterday', y.codeJour, "HIER");
        updateBadge('t-today', t.codeJour, "AUJOURD'HUI");
        updateBadge('t-tomorrow', tm.codeJour, "DEMAIN");

        document.getElementById('rem-bleu').innerText = s.restantBleu;
        document.getElementById('rem-blanc').innerText = s.restantBlanc;
        document.getElementById('rem-rouge').innerText = s.restantRouge;
    } catch (e) { console.error("Tempo API down"); }
}

function updateBadge(id, code, label) {
    const el = document.getElementById(id);
    const colors = { 1: ["BLEU", "BLEU"], 2: ["BLANC", "BLANC"], 3: ["ROUGE", "ROUGE"] };
    const [css, txt] = colors[code] || ["NON_DEFINI", "ATTENTE"];
    el.className = `t-badge ${css}`;
    el.innerHTML = `${label}<br>${txt}`;
}

async function updateData() {
    const url = `https://raw.githubusercontent.com/Zuldar/Tempo_data/main/archive_tempo.json?cb=${Date.now()}`;
    try {
        const response = await fetch(url);
        const data = await response.json();
        const f = data[0];

        document.getElementById('date-str').innerText = new Date(f.date_heure).toLocaleDateString('fr-FR', {day:'numeric', month:'long'}).toUpperCase();
        document.getElementById('time-str').innerText = f.heure;
        document.getElementById('co2-val').innerText = (f.taux_co2 || 0) + " g/kWh";
        
        const totalProd = (f.nucleaire||0)+(f.hydraulique||0)+(f.eolien||0)+(f.solaire||0)+(f.gaz||0)+(f.bioenergies||0);
        document.getElementById('prod-val').innerText = Math.round(totalProd).toLocaleString() + " MW";
        document.getElementById('conso-val').innerText = Math.round(f.consommation || 0).toLocaleString() + " MW";

        const pays = [{k:'angleterre', n:'UK ðŸ‡¬ðŸ‡§'},{k:'allemagne_belgique', n:'DE/BE ðŸ‡©ðŸ‡ª'},{k:'espagne', n:'ES ðŸ‡ªðŸ‡¸'},{k:'italie', n:'IT ðŸ‡®ðŸ‡¹'},{k:'suisse', n:'CH ðŸ‡¨H'}];
        let html = "";
        pays.forEach(p => {
            const val = f['ech_comm_' + p.k] || 0;
            const dv = Math.round(val * -1); 
            html += `<div class="flux-item"><span>${p.n}</span><b style="color:${dv>=0?'var(--green)':'var(--red-d)'}">${dv>0?'+':''}${dv}</b></div>`;
        });
        document.getElementById('flux-list').innerHTML = html;
    } catch (e) { console.error("Data error"); }
}

function updateAll() { fetchTempo(); updateData(); }
updateAll();
</script>
</body>
</html>

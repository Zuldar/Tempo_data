<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tempo Expert - Console Totale</title>
    <style>
        :root {
            --bg: #080808; --blue: #2979ff; --green: #00e676; --red: #ff1744; --orange: #ff9100; --grey: #222;
        }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; padding: 10px; margin: 0; }
        .box { background: rgba(255,255,255,0.05); border-radius: 24px; padding: 20px; border: 1px solid rgba(255,255,255,0.1); width: 100%; max-width: 420px; position: relative; box-sizing: border-box; }
        
        #alert-bar { display: none; background: var(--red); color: white; font-size: 0.65rem; font-weight: 900; text-align: center; padding: 6px; position: absolute; top: 0; left: 0; width: 100%; z-index: 10; }

        .header { display: flex; justify-content: space-between; align-items: flex-start; margin-top: 15px; margin-bottom: 25px; }
        .time-val { font-size: 1.8rem; color: var(--blue); font-weight: 900; line-height: 1; }
        .co2-badge { background: rgba(0,230,118,0.1); color: var(--green); padding: 5px 10px; border-radius: 8px; font-size: 0.7rem; font-weight: bold; border: 1px solid rgba(0,230,118,0.2); }

        .section-title { font-size: 0.6rem; color: #555; text-transform: uppercase; font-weight: 900; margin-bottom: 10px; letter-spacing: 1px; }
        
        /* Grille Production & Conso */
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .card { background: rgba(255,255,255,0.02); padding: 12px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); }
        .val { font-size: 1.1rem; font-weight: 900; margin-top: 4px; }
        
        /* Pr√©visions */
        .prev-box { display: flex; justify-content: space-between; font-size: 0.65rem; color: #888; margin-top: 8px; border-top: 1px solid #222; padding-top: 8px; }

        /* Stockage & Badges */
        .badge-row { display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .badge { background: var(--grey); padding: 6px 12px; border-radius: 20px; font-size: 0.6rem; font-weight: bold; white-space: nowrap; }

        /* Flux */
        .flux-container { background: rgba(255,255,255,0.02); border-radius: 16px; padding: 10px; }
        .flux-item { display: flex; justify-content: space-between; font-size: 0.75rem; padding: 8px 5px; border-bottom: 1px solid #1a1a1a; }
        .flux-item:last-child { border: none; }

        .btn-refresh { width: 100%; background: none; color: #444; border: 1px solid #222; padding: 12px; border-radius: 14px; font-size: 0.65rem; font-weight: bold; cursor: pointer; margin-top: 20px; transition: 0.2s; }
        .btn-refresh:hover { color: #fff; border-color: #444; }
    </style>
</head>
<body>

<div class="box">
    <div id="alert-bar">‚ö†Ô∏è RETARD DE R√âCEPTION RTE</div>

    <div class="header">
        <div>
            <div id="date-str" style="font-size: 0.75rem; color: #666; font-weight: bold; margin-bottom: 4px;">--</div>
            <div id="time-str" class="time-val">--:--</div>
        </div>
        <div id="co2-val" class="co2-badge">-- g/kWh</div>
    </div>

    <div class="section-title">Bilan National</div>
    <div class="main-grid">
        <div class="card">
            <div style="font-size:0.55rem; color:#888;">PRODUCTION</div>
            <div id="prod-val" class="val" style="color: var(--green);">--</div>
        </div>
        <div class="card">
            <div style="font-size:0.55rem; color:#888;">CONSOMMATION</div>
            <div id="conso-val" class="val">--</div>
            <div class="prev-box">
                <div>Pr√©v. J : <b id="prev-j" style="color:white;">--</b></div>
                <div>J+1 : <b id="prev-j1" style="color:white;">--</b></div>
            </div>
        </div>
    </div>

    <div class="section-title">Stockage & Flexibilit√©</div>
    <div class="badge-row">
        <div class="badge">STEPS : <span id="val-step" style="color:var(--blue)">--</span></div>
        <div class="badge">BATTERIES : <span id="val-batt" style="color:var(--blue)">--</span></div>
    </div>

    <div class="section-title">√âchanges Transfrontaliers (MW)</div>
    <div class="flux-container" id="flux-list"></div>

    <button class="btn-refresh" onclick="updateConsole()">üîÑ ACTUALISER LES DONN√âES</button>
</div>

<script>
async function updateConsole() {
    const pseudo = "Zuldar"; 
    const depot = "Tempo_data"; 
    const url = `https://raw.githubusercontent.com/${pseudo}/${depot}/main/archive_tempo.json?cb=${Date.now()}`;

    try {
        const response = await fetch(url);
        const data = await response.json();
        const f = data[0];

        // 1. Fra√Æcheur
        const dateDonnee = new Date(f.date_heure);
        const difference = (new Date() - dateDonnee) / (1000 * 60 * 60);
        document.getElementById('alert-bar').style.display = difference > 2 ? 'block' : 'none';

        // 2. Header
        document.getElementById('date-str').innerText = dateDonnee.toLocaleDateString('fr-FR', {weekday:'long', day:'numeric', month:'long'}).toUpperCase();
        document.getElementById('time-str').innerText = f.heure;
        document.getElementById('co2-val').innerText = (f.taux_co2 || 0) + " g/kWh";
        
        // 3. Bilans & Pr√©visions
        const totalProd = (f.nucleaire||0)+(f.hydraulique||0)+(f.eolien||0)+(f.solaire||0)+(f.gaz||0)+(f.bioenergies||0);
        document.getElementById('prod-val').innerText = Math.round(totalProd).toLocaleString() + " MW";
        document.getElementById('conso-val').innerText = Math.round(f.consommation || 0).toLocaleString() + " MW";
        document.getElementById('prev-j').innerText = f.prevision_j ? Math.round(f.prevision_j/1000) + "k" : "--";
        document.getElementById('prev-j1').innerText = f.prevision_j1 ? Math.round(f.prevision_j1/1000) + "k" : "--";

        // 4. Stockage (Pompage + Batteries)
        // Note : RTE indique le pompage en n√©gatif, on l'affiche tel quel ou en valeur absolue selon ta pr√©f√©rence
        document.getElementById('val-step').innerText = (f.pompage || 0) + " MW";
        const batt = (f.destockage_batterie || 0) + (f.stockage_batterie || 0);
        document.getElementById('val-batt').innerText = batt + " MW";

        // 5. Flux
        const pays = [
            {k:'angleterre', n:'Royaume-Uni üá¨üáß'},
            {k:'allemagne_belgique', n:'Allemagne/BE üá©üá™'},
            {k:'espagne', n:'Espagne üá™üá∏'},
            {k:'italie', n:'Italie üáÆüáπ'},
            {k:'suisse', n:'Suisse üá®H'}
        ];

        let html = "";
        pays.forEach(p => {
            const val = f['ech_comm_' + p.k] || 0;
            const displayVal = Math.round(val * -1); 
            const color = displayVal >= 0 ? "var(--green)" : "var(--red)";
            html += `<div class="flux-item"><span>${p.n}</span><b style="color:${color}">${displayVal > 0 ? '+' : ''}${displayVal}</b></div>`;
        });
        document.getElementById('flux-list').innerHTML = html;

    } catch (e) { console.error("Erreur de synchro"); }
}
updateConsole();
</script>
</body>
</html>
